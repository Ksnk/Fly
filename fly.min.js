/*@cc_on @*/
(function(){var cursor={x:-1,y:0};function the_fly(param){this._cnt=1;this.state="hidden";this.coord={x:200,y:100};this.speed=0;this.angle=0;fly=document.createElement("canvas");fly.className="fly";fly.setAttribute("width","97");fly.setAttribute("height","97");this.element=document.body.appendChild(fly);
/*@if (@_jscript_version >= 1)
    	G_vmlCanvasManager.initElement(this.element);
	@end @*/
if(param){for(a in param){this[a]=param[a]}}this.kadr=0;this.done=function(){this.element=null};this.dist=function(cursor){var dx=cursor.x-48.5-this.coord.x,dy=-cursor.y+this.coord.y+48.5;return Math.sqrt(dx*dx+dy*dy)};this.lookat=function(cursor){if(cursor.x!=-1){var dx=cursor.x-48.5-this.coord.x,dy=-cursor.y+this.coord.y+48.5;var dd=Math.sqrt(dx*dx+dy*dy);if(dd>0.001){this.angle=Math.acos(dx/dd);if(dy<0){this.angle=-this.angle}}}};var fly_states=["stay","walk","fly"];this.nextstep=function(state){if(this._cnt>0&&!state){this._cnt--}else{this.state=0}switch(this.state){case"stay":this.lookat(cursor);this.kadr=0;break;case"walk":this.coord.x+=Math.cos(this.angle)*this.speed;this.coord.y-=Math.sin(this.angle)*this.speed;this.kadr=this._cnt&3;break;case"fly":this.coord.x+=Math.cos(this.angle)*this.speed;this.coord.y-=Math.sin(this.angle)*this.speed;this.kadr=4;break;case"hidden":this.coord.x=Math.ceil(Math.random()*engine.window.x+engine.scroll.x);this.coord.y=Math.ceil(Math.random()*engine.window.y+engine.scroll.y);default:this.state=state||fly_states[Math.floor(Math.random()*fly_states.length)];this._cnt=Math.round(30+Math.random(30));this.kadr=0;switch(this.state){case"walk":this.speed=6;this.lookat({x:Math.random()*engine.window.x+engine.scroll.x,y:Math.random()*engine.window.y+engine.scroll.y});break;case"fly":this.speed=50;this._cnt-=20;this.kadr=4;this.lookat({x:Math.random()*engine.window.x+engine.scroll.x,y:Math.random()*engine.window.y+engine.scroll.y});break;default:this.speed=0}}};this.draw=function(){if(this.element&&this.element.getContext){this.element.style.top=this.coord.y+"px";this.element.style.left=this.coord.x+"px";var ctx=this.element.getContext("2d");ctx.fillStyle="rgba(255,255,255,0)";ctx.clearRect(-97,-97,194,194);ctx.lineWidth=1;var _img=document.getElementById("fly_01");try{if(typeof(_img.complete)=="undefined"||_img.complete){ctx.save();ctx.translate(48.5,48.5);ctx.rotate(1.57079632679-this.angle);ctx.drawImage(_img,0,this.kadr*100,60,75,-30,-37.5,60,75);ctx.restore()}}catch(e){}if(60>this.dist(cursor)&&this.state!="fly"){this.nextstep("fly")}else{this.nextstep()}}}}var engine={scroll:{x:0,y:0},calc_Bounds:function(){engine.window={x:document.compatMode=="CSS1Compat"&&!window.opera?document.documentElement.clientWidth:document.body.clientWidth,y:document.compatMode=="CSS1Compat"&&!window.opera?document.documentElement.clientHeight:document.body.clientHeight};engine.scroll={x:(document.documentElement&&document.documentElement.scrollLeft)||(document.body&&document.body.scrollLeft),y:(document.documentElement&&document.documentElement.scrollTop)||(document.body&&document.body.scrollTop)}},_handlers:{},_curhandle:"0",set:function(x){if(!x){x="0"}this._curhandle=x;return this},$:function(id){return(typeof id=="string")?document.getElementById(id):id},add_event:function(a,e,o,c,d){if(!a){return this}if(e instanceof Array){for(var i in e){this.add_event(a,e[i],o)}return this}if(!o){o=this[e]}if(!o){return null}var fn=o;if(!fn.__binded){fn=function(e){return o.call(a,e||window.event,c,d)}}fn.__binded=true;if(a.addEventListener){a.addEventListener(e,fn,false)}else{if(a.attachEvent){try{a.attachEvent(e="on"+e,fn)}catch(aEx){}}}var ind=this._curhandle,h=this._handlers;if(!h[ind]){h[ind]=[]}h[ind].push({a:a,e:e,o:fn});return this},clear_events:function(ind){var h,o,hh=this._handlers[ind||0];if(hh){while(h=hh.pop()){if(h.a.removeEventListener){h.a.removeEventListener(h.e,h.o,false)}else{if(o=h.a.detachEvent){try{o(h.e,h.o)}catch(aEx){}}}}}return this},mousetgt:(window.execScript||window.opera)?document:window,clearEv:function(e){if(e.preventDefault){e.preventDefault()}e.cancelBubble=true;if(e.stopPropagation){e.stopPropagation()}return(e.returnValue=false)},debug:function(){},appendScript:function(src,callback){var scriptElem=document.createElement("script");scriptElem.setAttribute("type","text/javascript");if(callback){scriptElem.onload=function(){scriptElem.onreadystatechange=null;scriptElem.onload=null;callback()};scriptElem.onreadystatechange=function(){if("loaded"==this.readyState){scriptElem.onload()}}}scriptElem.setAttribute("src",src);document.getElementsByTagName("head")[0].appendChild(scriptElem)},appendCSSRules:function(text){
/*@if (@_jscript_version >= 1)
		var cssreg=/([^{]+){([^}]+)}/g, res;
		while (res=cssreg.exec(text)) {
			document.styleSheets[0].addRule(res[1].replace(/^\s+|\s+$/g,''),res[2].replace(/^\s+|\s+$/g,''));
		}
		@else @*/
var style=document.createElement("style");style.type="text/css";if(style.styleSheet){style.styleSheet.cssText=" "+text}else{if(style.innerText==""){style.innerText=text}else{style.innerHTML=text}}document.getElementsByTagName("head")[0].appendChild(style);
/*@end @*/
},objects:[],add:function(elem){this.objects.push(elem)},init_fly:function(){this.add(new the_fly());this.add(new the_fly());this.add(new the_fly());this.add(new the_fly());this.add(new the_fly());this.add(new the_fly());this.add(new the_fly());this.add(new the_fly())},init:function(){this.add_event(window,"load",function(){
/*@if (@_jscript_version >= 1)
		engine.appendScript('http://ksnk.github.com/Fly/excanvas-modified.min.js',function(){engine.excanvas_complete=true;});
		/*@end @*/
engine.appendCSSRules("#fly_prepare { position:absolute; visibility:hidden; top:0; left:0; } #debug {color:red; position:fixed; top:0; left:0;} .fly { position: absolute; top:0; left:0px; z-index:1000; }");var fly=document.createElement("div");fly.setAttribute("id","fly_prepare");fly.innerHTML='<img class="fly_src" id="fly_01" src="http://ksnk.github.com/Fly/03.png">';document.body.appendChild(fly);
/*@if (@_jscript_version >= 1)
		    function xxx(){
		      if(engine.excanvas_complete && G_vmlCanvasManager){
		        if (!document.namespaces || !document.namespaces['g_vml_']){
		            G_vmlCanvasManager.init_(document);
		        } 
		        engine.calc_Bounds();
		        engine.init_fly();
			  }
			  else
			    setTimeout(xxx,100);
		    }
			setTimeout(xxx,100);
		@else @*/
setTimeout(function(){engine.calc_Bounds();engine.init_fly()},100);
/*@end @*/
engine.draw()});this.add_event(window,"unload");this.add_event(this.mousetgt,"mousemove",function(e){cursor.x=e.clientX+(engine.scroll.x||0);cursor.y=e.clientY+(engine.scroll.y||0)});this.add_event(window,"resize",this.calc_Bounds);this.add_event(window,"scroll",this.calc_Bounds);this._drawto=setInterval(this.draw,50)},unload:function(){if(engine._drawto){clearInterval(engine._drawto)}if(engine.objects){for(var i=0;i<engine.objects.length;i++){engine.objects[i].done();engine.objects[i]=null}}for(var i in engine._handlers){engine.clear_events(i)}},draw:function(){for(var i=0;i<engine.objects.length;i++){engine.objects[i].draw()}}};engine.init()})();